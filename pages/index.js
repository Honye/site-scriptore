import { useState, useEffect } from 'react'
import Head from 'next/head'
import Image from 'next/image'
import BottomNavigation from '@mui/material/BottomNavigation'
import BottomNavigationAction from '@mui/material/BottomNavigationAction'
import WidgetsIcon from '@mui/icons-material/Widgets';
import MoveToInboxIcon from '@mui/icons-material/MoveToInbox';
import InfoIcon from '@mui/icons-material/Info';
import WhatshotIcon from '@mui/icons-material/Whatshot';
import List from '@mui/material/List'
import ListItem from '@mui/material/ListItem';
import { Button } from '@mui/material'
import styles from '../styles/Home.module.css'
import { ListItemAvatar } from '@mui/material'
import { Avatar, Container } from '@mui/material'
import { red } from '@mui/material/colors'
import { ListItemText } from '@mui/material'

export default function Home() {
  const [value, setValue] = useState(0)

  const invoke = (code, data) => {
    window.dispatchEvent(
      new CustomEvent(
        'JBridge',
        { detail: { code, data } }
      )
    )
  }

  const install = (name) => {
    console.log(`[Web] invoke intall "${name}"`)
    invoke('install', name)
  }

  const listener = (event) => {
    const { code, data } = event.detail
    console.log(`[Web] message from Scriptable. ${JSON.stringify({ code, data })}`)
  }

  useEffect(() => {
    window.addEventListener('JWeb', listener)
    return () => {
      window.removeEventListener('JWeb', listener)
    }
  }, [])

  return (
    <div>
      <Head>
        <title>Scriptable Store</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <Container maxWidth='sm'>
          <List>
            <ListItem>
              <ListItemAvatar>
                <Avatar
                  sx={{ borderRadius: 2, bgcolor: red[400] }}
                  variant='square'
                >
                  <WhatshotIcon />
                </Avatar>
              </ListItemAvatar>
              <ListItemText primary='Weibo' secondary='Weibo hot search list'></ListItemText>
              <Button
                sx={{textTransform:'none', ml:'auto'}}
                variant='outlined'
                size='small'
                onClick={() => install('Weibo')}
              >Install</Button>
            </ListItem>
          </List>
        </Container>
      </main>
      
      <BottomNavigation
        sx={{ position: 'fixed', bottom: 0, left: 0, right: 0 }}
        value={value}
        showLabels
        onChange={(e, value) => setValue(value)}
      >
        <BottomNavigationAction label='Scripts' icon={<WidgetsIcon />} />
        <BottomNavigationAction label='Updates' icon={<MoveToInboxIcon />} />
        <BottomNavigationAction label='About' icon={<InfoIcon />} />
      </BottomNavigation>
    </div>
  )
}
